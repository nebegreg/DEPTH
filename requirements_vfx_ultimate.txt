# Depth Anything v3 - VFX ULTIMATE Edition Requirements
# ======================================================
# Professional VFX pipeline with Autodesk Flame integration

# ==================== CORE DEPENDENCIES ====================

# Deep Learning
torch>=2.0.0
torchvision>=0.15.0
numpy<2.0.0

# GUI Framework
PyQt6>=6.4.0
PyQt6-Qt6>=6.4.0

# Image Processing
opencv-python>=4.7.0
Pillow>=9.5.0
imageio>=2.27.0
imageio-ffmpeg>=0.4.8  # For video codec support
moviepy>=1.0.3
pillow-heif>=0.10.0

# 3D Processing
open3d>=0.17.0
trimesh>=3.21.0
plyfile>=0.9.0

# Depth Anything v3
huggingface_hub>=0.14.0
safetensors>=0.3.1
einops>=0.6.1
omegaconf>=2.3.0
xformers>=0.0.20  # Optional but recommended for performance

# ==================== VFX FORMATS ====================

# OpenEXR (Industry Standard)
openexr>=1.3.9  # May require system libraries
# On Ubuntu/Debian: sudo apt-get install libopenexr-dev python3-openexr
# On macOS: brew install openexr
# On Windows: Use conda or pre-built wheels

# DPX Support (built into imageio)
# Already covered by imageio

# Additional Image Formats
tifffile>=2023.3.15  # Advanced TIFF support
rawpy>=0.18.0  # RAW camera formats (optional)

# ==================== 3D FORMATS ====================

# FBX Export (ASCII FBX - no external deps)
# Binary FBX requires FBX SDK (optional, proprietary)

# Alembic Support (Optional - for advanced users)
# alembic>=1.8.0
# Note: Alembic Python bindings can be difficult to install
# May require building from source
# For most users, ASCII FBX export is sufficient

# ==================== VIDEO CODECS ====================

# Advanced video support
av>=10.0.0  # PyAV for professional video formats

# Additional codecs (optional)
# ffmpeg-python>=0.2.0  # Python wrapper for ffmpeg

# ==================== SCIENTIFIC COMPUTING ====================

scipy>=1.10.0  # For image processing utilities
scikit-image>=0.20.0  # Additional image algorithms

# ==================== UTILITIES ====================

# Performance
fastapi>=0.95.0
uvicorn>=0.21.0
requests>=2.28.0
typer>=0.9.0

# Color science
colour-science>=0.4.2  # For color space conversions (optional)

# Metadata
pyexiv2>=2.8.0  # EXIF/XMP metadata (optional, may need system libs)

# Point cloud processing
pyntcloud>=0.3.1  # Optional - additional point cloud tools

# Math and geometry
transforms3d>=0.4.1  # 3D transformations
pyquaternion>=0.9.9  # Quaternion math for rotations

# ==================== OPTIONAL ADVANCED FEATURES ====================

# Deep Compositing (OpenEXR 2.0 deep data)
# Requires OpenEXR with deep support - build from source if needed

# Machine Learning for VFX
# scikit-learn>=1.2.0  # For ML-based processing

# GPU Acceleration
# cupy>=12.0.0  # CUDA acceleration for NumPy operations (optional)

# ==================== DEVELOPMENT TOOLS ====================

# Code quality (optional)
# pre-commit>=3.0.0
# black>=23.0.0
# flake8>=6.0.0
# pytest>=7.0.0

# ==================== INSTALLATION NOTES ====================

# RECOMMENDED INSTALLATION ORDER:
# ================================

# 1. Install PyTorch with CUDA support first:
#    pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118

# 2. Install system dependencies for OpenEXR:
#    Ubuntu/Debian: sudo apt-get install libopenexr-dev libilmbase-dev
#    macOS: brew install openexr
#    Windows: conda install -c conda-forge openexr-python

# 3. Install this requirements file:
#    pip install -r requirements_vfx_ultimate.txt

# 4. Install Depth Anything v3:
#    cd Depth-Anything-3-main && pip install -e .

# TROUBLESHOOTING:
# ================

# OpenEXR installation issues:
# ----------------------------
# If pip install openexr fails:
#
# Option 1 - Conda (easiest):
#   conda install -c conda-forge openexr-python
#
# Option 2 - Pre-built wheels:
#   pip install --upgrade pip
#   pip install openexr --no-cache-dir
#
# Option 3 - From source:
#   # Install dev libraries first, then:
#   pip install openexr --no-binary openexr
#
# Option 4 - Skip OpenEXR:
#   # App will work without it, just won't export multi-channel EXR
#   # Can still use TIFF 32-bit or DPX

# xformers installation issues:
# -----------------------------
# If xformers fails (older GPUs):
#   # See: https://github.com/ByteDance-Seed/Depth-Anything-3/issues/11
#   # Skip xformers - performance will be slightly reduced
#   pip install -r requirements_vfx_ultimate.txt --no-deps xformers
#   # Or comment out xformers line above

# Alembic installation:
# --------------------
# Alembic is optional and complex to install
# Most users should use FBX export instead
# Only install if specifically needed:
#   # May require building from source
#   git clone https://github.com/alembic/alembic
#   # Follow build instructions in repo

# av (PyAV) installation:
# ----------------------
# If av installation fails:
#   conda install -c conda-forge av
# Or:
#   # Install ffmpeg dev libraries first
#   sudo apt-get install libavformat-dev libavcodec-dev libavutil-dev
#   pip install av

# PLATFORM-SPECIFIC NOTES:
# ========================

# Linux (Ubuntu/Debian):
# ----------------------
# sudo apt-get update
# sudo apt-get install -y \
#   libopenexr-dev \
#   libilmbase-dev \
#   libavformat-dev \
#   libavcodec-dev \
#   libavutil-dev \
#   python3-dev

# macOS:
# ------
# brew install openexr ffmpeg

# Windows:
# --------
# Use conda for easiest installation:
# conda install -c conda-forge openexr-python av

# MINIMAL INSTALLATION (without optional features):
# =================================================
# If you want minimal install without OpenEXR/advanced formats:
#
# torch>=2.0.0
# torchvision>=0.15.0
# numpy<2.0.0
# PyQt6>=6.4.0
# opencv-python>=4.7.0
# Pillow>=9.5.0
# imageio>=2.27.0
# open3d>=0.17.0
# huggingface_hub>=0.14.0
# safetensors>=0.3.1
# einops>=0.6.1
# omegaconf>=2.3.0
#
# Then in Depth-Anything-3-main:
# pip install -e .

# VFX PIPELINE RECOMMENDATIONS:
# =============================

# For Autodesk Flame integration:
#   - OpenEXR is HIGHLY recommended (industry standard)
#   - DPX support via imageio (already included)
#   - FBX camera export (built-in, no external deps)

# For Nuke integration:
#   - OpenEXR (essential)
#   - Multi-channel export
#   - Deep compositing (advanced)

# For After Effects:
#   - TIFF 32-bit or PNG sequences work well
#   - OpenEXR also supported

# For Blender:
#   - FBX for camera tracking
#   - PLY for point clouds
#   - OpenEXR for render passes

# PERFORMANCE OPTIMIZATION:
# =========================

# For best performance:
#   1. Install CUDA-enabled PyTorch
#   2. Install xformers (if GPU supports it)
#   3. Use OpenEXR with ZIP compression (good balance)
#   4. Consider SSD storage for large sequences

# For memory-constrained systems:
#   1. Use smaller models (DA3-BASE or DA3-SMALL)
#   2. Process in batches
#   3. Use DPX 10-bit instead of 16-bit
#   4. Enable image compression

# VERIFYING INSTALLATION:
# =======================

# Run this after installation to verify:
#
# python -c "
# import torch
# import PyQt6
# import cv2
# import numpy as np
# import open3d
# import imageio
# try:
#     import OpenEXR
#     print('✓ OpenEXR available')
# except:
#     print('✗ OpenEXR not available (optional)')
#
# print('✓ All core dependencies OK')
# print(f'CUDA available: {torch.cuda.is_available()}')
# "
